function addEventListeners(){let e=document.querySelector("#new_member_name");e&&e.addEventListener("input",sendLookNamesRequest);let t=document.querySelector("#new_chat_name");t&&t.addEventListener("keypress",function(e){"Enter"==e.key&&sendNewChatRequest(e)});let s=document.querySelectorAll("#chat_content form#newmessage");[].forEach.call(s,function(e){e.addEventListener("submit",sendCreateMessageRequest)});let a=document.querySelectorAll("#leave_chat_button");[].forEach.call(a,function(e){e.addEventListener("click",sendLeaveChatRequest)});let n=document.querySelector("#messages_col");n&&n.addEventListener("scroll",infinite_chat)}function sendCreateMessageRequest(e){let t=this.querySelector("input").value,s=this.closest("#chat_content").getAttribute("data-id");return""!=t&&sendAjaxRequest("put","/api/chats/"+s+"/message",{body:t},messageAddedHandler),e.preventDefault(),!1}function sendLeaveChatRequest(e){let t=this.closest("div").getAttribute("data-id"),s=document.getElementsByClassName("chat")[0].getAttribute("data-id");sendAjaxRequest("delete","/api/chats/"+s+"/deleteUser",{user_id:t},deletedUserHandler),e.preventDefault()}function deletedUserHandler(){if(200!=this.status&&201!=this.status)return void(window.location="/chats");JSON.parse(this.responseText);window.location="/chats"}function messageAddedHandler(){if(200!=this.status&&201!=this.status)return;let e=JSON.parse(this.responseText),t=(createMessage(e),document.querySelector('#chat_content[data-id="'+e.chat_id+'"]').querySelector("div.chat_message_input").querySelector("input"));t.value="",t.blur()}function sendLookNamesRequest(e){let t=this.value,s=window.location.pathname.split("/")[2];sendAjaxRequest("get","/api/chats/"+s+"/friends?string="+t,null,showNewMembersHandler)}function sendNewChatRequest(e){let t=document.getElementById("new_chat_name").value;sendAjaxRequest("put","/api/chats/create",{name:t},newChatHandler),e.preventDefault()}function showNewMembersHandler(){if(200!=this.status&&201!=this.status)return;let e=JSON.parse(this.responseText),t=document.querySelector("#members_search");t.innerHTML="",e.new_members.forEach(e=>{t.innerHTML+=createSearchedMember(e)}),0==e.new_members.length&&(t.innerHTML="No new users match that description"),adders=t.querySelectorAll(".add_member"),[].forEach.call(adders,function(e){e.addEventListener("click",sendAddMemberToChatRequest)})}function newChatHandler(){if(200!=this.status&&201!=this.status)return;let e=JSON.parse(this.responseText),t=createChat(e);document.querySelector("div#user_chats").prepend(t),window.location="/chats/"+e.chat_id}function sendAddMemberToChatRequest(e){let t=window.location.pathname.split("/")[2],s=this.getAttribute("data-id");sendAjaxRequest("put","/api/chats/"+t+"/"+s,null,addedUserChatHandler),e.preventDefault()}function addedUserChatHandler(){if(200!=this.status)return;let e=JSON.parse(this.responseText);document.querySelector("#addToChat_"+e.user.regular_user_id).remove();let t=document.querySelector("#chats_view_"+e.chat_id+" .chat_user_info_article_div .chat_user_images"),s=t.childElementCount,a=null;s<3?(a=`<img style="width:30px;height:30px;border-radius:50%;float:left;position:relative;left:${-15*s}px;" `,e.image?a+=`src="${e.image}" `:a+='src="https://www.pluspixel.com.br/wp-content/uploads/avatar-7.png" ',a+='class="mx-auto" alt="user"/>'):3==s&&(a='<img  style="width:30px;height:30px;border-radius:50%;float:left;position:relative;left:-45px" \n      src="https://comunicadores.info/wp-content/uploads/2014/12/very-basic-plus-icon.png" class="mx-auto" alt="user"/>'),a&&t.insertAdjacentHTML("beforeend",a);let n=`<div class="card mb member_card" style="margin-bottom:0px;border-radius:0px;" data-id="${e.user.regular_user_id}">\n        <div class="row no-gutters">\n            <div class="col-md" style="flex-grow:1; max-width:100%; text-align: left;">\n                <a href="../users/${e.user.regular_user_id}" style="text-decoration: none; color:black">\n                    <div class="row no-gutters">\n                        <div class="col-sm">\n                            <div class="card text-center" style="border-right:none;border-bottom:none;border-top:none;border-radius:0;height:100%;">\n                                <img`;e.image?n+=` src="${e.image}"`:n+=' src="https://www.pluspixel.com.br/wp-content/uploads/avatar-7.png" ',n+=`class="card-img-top mx-auto d-block" \n                                alt="..." style="border-radius:50%; width:3rem;height:3rem; padding:0.1rem;padding-top:0.2rem">\n                            </div>\n                        </div>\n                        <div class="col-md-8" style="flex-grow:1; max-width:100%; text-align: left;">\n                            <div class="" style="margin-bottom: 0;padding-bottom: 0;">\n                                <p class="card-text small_post_body" style="margin-bottom:0;margin-left:0.2rem;display:inline-block;">\n                                  ${e.user.user.name}\n                                </p>\n                            </div>\n                        </div>\n                    </div>\n                </a> \n            </div>\n        </div>\n    </div>`,document.querySelector("#viewMembersModal .modal-body").insertAdjacentHTML("beforeend",n)}function createChat(e){let t=document.createElement("article");return t.classList.add("card-mb-3","chat_user_info_article"),t.innerHTML=`\n      <a href = "/chats/${e.chat_id}" style="color: inherit; text-decoration: none;">\n      <div class="row chat_user_info_article_div" style="margin-left:15px">\n        \n            <img class="card-img" src="https://image.flaticon.com/icons/svg/166/166258.svg" alt="" style="width:2.5em;height:2.5em; border-radius:50%"/>\n        \n        \n           <h2 class="card-title" style="margin-left:10px; margin-right:40px">${e.chat_name}</h2>\n           <img \n           @if (isset($image) && $image !== null)\n                   src="{{$image->file_path}}"\n           @else\n           src="https://www.pluspixel.com.br/wp-content/uploads/avatar-7.png"\n           @endif\n           alt="" class="rounded-circle" style="max-width:8%; max-height: 2%;" align="left"/>\n    </div>\n    </a>  \n    `,t}function createSearchedMember(e){let t=`\n          <div class="card mb" style="margin-bottom:0px;border-radius:0px;margin-right:0.5rem" id='addToChat_${e.userable_id}'>\n            <a href="/users/${e.userable_id}" style="text-decoration: none; color:black">\n                <div class="row no-gutters">\n                    <div class="col-sm">\n                        <div class="card text-center" style="border-right:none;border-bottom:none;border-top:none;border-radius:0;height:100%;">`;return e.file_path?t+=`<img src="${e.file_path}" class="card-img-top mx-auto d-block" \n                            alt="..." style="border-radius:50%; max-width:3rem; padding:0.1rem;padding-top:0.2rem">`:t+='<img src="https://www.pluspixel.com.br/wp-content/uploads/avatar-7.png" class="card-img-top mx-auto d-block" \n                              alt="..." style="border-radius:50%; max-width:3rem; padding:0.1rem;padding-top:0.2rem">',t+=`</div>\n                    </div>\n                    <div class="col-md-8" style="flex-grow:1; max-width:100%; text-align: left;">\n                        <div class="" style="margin-bottom: 0;padding-bottom: 0;">\n                            <p class="card-text small_post_body" style="margin-bottom:0;margin-left:0.2rem;display:inline-block;">\n                                ${e.name}\n                            </p>\n                            <span class="btn btn-light add_member" data-id='${e.userable_id}' \n                                style="background-color: rgba(0,0,150,.03);float:right; margin-right:0.5rem;margin-top:0.2rem;font-size:0.9rem ">\n                                Add member\n                            </span>\n                        </div>\n                    </div>\n                </div>\n            </a> \n        </div>`}function createMessage(e){let t=document.createElement("p");return t.className="chat_my_message",t.innerHTML=`\n        ${e.body}\n      `,t}let sent_chat=!1;function infinite_chat(){if(this.scrollTop<100&&!sent_chat){sent_chat=!0;let e=null,t="",s=window.location.pathname.split("/");if("chats"!=s[1])return;t="/api/chats/"+s[2]+"/messages/",e=document.querySelector("#messages_col :first-child").getAttribute("data-id"),sendAjaxRequest("get",t+e,null,addMessages)}}function addMessages(){if(200!=this.status&&201!=this.status)return void(sent_chat=!1);if(this.responseText.length<5)return;if("chats"==window.location.pathname.split("/")[1]){let e=document.querySelector("#messages_col"),t=e.scrollHeight;document.querySelector("#messages_col").insertAdjacentHTML("afterbegin",this.responseText);e.scrollHeight}sent_chat=!1}addEventListeners();