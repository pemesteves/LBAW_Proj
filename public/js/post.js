function addEventListeners(){let e=document.querySelectorAll("article.post button.upvote");[].forEach.call(e,function(e){e.addEventListener("click",sendLikePostRequest)});let t=document.querySelectorAll("article.post button.downvote");[].forEach.call(t,function(e){e.addEventListener("click",sendDislikePostRequest)});let o=document.querySelectorAll(".comment_container .comment_votes button.comment_upvote");[].forEach.call(o,function(e){e.addEventListener("click",sendLikeCommentRequest)});let n=document.querySelectorAll(".comment_container .comment_votes button.comment_downvote");[].forEach.call(n,function(e){e.addEventListener("click",sendDislikeCommentRequest)});let r=document.querySelectorAll(".comment_container div.options_menu .comment_delete");[].forEach.call(r,function(e){e.addEventListener("click",sendDeleteCommentRequest)});let s=document.querySelectorAll(".comment_container div.options_menu .comment_edit");[].forEach.call(s,function(e){e.addEventListener("click",setCommentEditBox)});let i=document.querySelectorAll("article.post button.comment_report");[].forEach.call(i,function(e){e.addEventListener("click",openReportCommentModal)});let d=document.querySelector("form#post_form");null!=d&&d.addEventListener("submit",sendCreatePostRequest);let l=document.querySelectorAll("article.post button.delete");[].forEach.call(l,function(e){e.addEventListener("click",sendDeletePostRequest)});let a=document.querySelectorAll("div.post_container form");[].forEach.call(a,function(e){e.addEventListener("submit",sendCreateCommentRequest)});let c=document.querySelectorAll("article.post button.report");[].forEach.call(c,function(e){e.addEventListener("click",openReportPostModal)});let u=document.querySelectorAll("article.post button.archive");[].forEach.call(u,function(e){e.addEventListener("click",sendArchivePostRequest)});let m=document.querySelectorAll("article.post button.unarchive");[].forEach.call(m,function(e){e.addEventListener("click",sendUnarchivePostRequest)})}function sendLikePostRequest(e){let t=this.closest("article").getAttribute("data-id");sendAjaxRequest("put","/api/posts/"+t+"/like/1",null,postLikeHandler),e.preventDefault()}function sendDislikePostRequest(e){let t=this.closest("article").getAttribute("data-id");sendAjaxRequest("put","/api/posts/"+t+"/like/0",null,postLikeHandler),e.preventDefault()}function sendLikeCommentRequest(e){let t=this.closest(".comment_container").getAttribute("data-id");sendAjaxRequest("put","/api/comments/"+t+"/like/1",null,commentLikeHandler),e.preventDefault()}function sendDislikeCommentRequest(e){let t=this.closest(".comment_container").getAttribute("data-id");sendAjaxRequest("put","/api/comments/"+t+"/like/0",null,commentLikeHandler),e.preventDefault()}function postLikeHandler(){if(200!=this.status)return;let e=JSON.parse(this.responseText),t=document.querySelector('article.post[data-id="'+e.post_id+'"] .votes'),o=t.querySelector(".post_like"),n=t.querySelector(".post_dislike");o.textContent=parseInt(o.textContent)+e.upvotes,n.textContent=parseInt(n.textContent)+e.downvotes,o=(t=document.querySelector('article.post[data-id="'+e.post_id+'"] .post_votes')).querySelector(".post_like"),n=t.querySelector(".post_dislike"),o.textContent=String.fromCharCode(160)+(parseInt(o.textContent)+e.upvotes)+String.fromCharCode(160),n.textContent=String.fromCharCode(160)+(parseInt(n.textContent)+e.downvotes)+String.fromCharCode(160)}function commentLikeHandler(){if(200!=this.status)return;let e=JSON.parse(this.responseText),t=document.querySelector('div.comment_container[data-id="'+e.comment_id+'"] .comment_votes'),o=t.querySelector(".comment_like"),n=t.querySelector(".comment_dislike");o.textContent=parseInt(o.textContent)+e.upvotes,n.textContent=parseInt(n.textContent)+e.downvotes}function sendDeleteCommentRequest(e){let t=this.closest("div.comment_container").getAttribute("data-id");sendAjaxRequest("delete","/api/comments/"+t,null,commentDeletedHandler)}function commentDeletedHandler(){if(200!=this.status)return void addErrorFeedback("Failed to delete comment.");let e=JSON.parse(this.responseText),t=document.querySelector('div.comment_container[data-id="'+e.comment_id+'"]'),o=document.querySelector("#post_"+e.post_id+" .comments_count");o.innerHTML=parseInt(o.textContent)-1+" comments",t.remove()}function openReportCommentModal(e){let t=this.closest(".comment_container").getAttribute("data-id");$("#reportModal").modal("show");let o=document.querySelector("#reportModal");o.querySelector("#reportModalLabel").innerHTML="Report comment",o.querySelector("#report_id").value=t,o.querySelector(".sendReport").removeEventListener("click",sendReportPostRequest),o.querySelector(".sendReport").addEventListener("click",sendReportCommentRequest)}function sendReportCommentRequest(e){let t=this.closest("#reportModal"),o=t.querySelector("#report_id").value;t.querySelector("#report_id").value="";let n=t.querySelector("#report_title").value;t.querySelector("#report_title").value="";let r=t.querySelector("#report_description").value;t.querySelector("#report_description").value="",$("#reportModal").modal("hide"),sendAjaxRequest("put","/api/comments/"+o+"/report",{title:n,description:r},commentReportedHandler)}function commentReportedHandler(){if(201!==this.status&&200!==this.status)return void(window.location="/");JSON.parse(this.responseText);addFeedback("Comment reported sucessfully")}function setCommentEditBox(e){let t=this.closest("div.comment_container"),o=t.querySelector("p").textContent,n=t.getAttribute("data-id");t.innerHTML=`\n    <div class="modal-body comment_edit_container" style="overflow-y: auto;" data-id = ${n}>\n      <div class="container" style="border-bottom:0;border-top:0;border-radius:0;height:100%;">\n        <form class="comment_edit" method="put" action="/api/comments/${n}/edit">                    \n          <div class="row post_comment_form" >\n              <div class="col-2">\n                  <img src="https://www.pluspixel.com.br/wp-content/uploads/avatar-7.png" class="mx-auto d-block" alt="..." style="border-radius:50%; max-width:2rem; ">\n              </div>\n              <div class="col-9 post_comment_form_text">\n                  <textarea name="body" class="form-control" required placeholder="Comment..." rows="1">${o}</textarea>\n              </div>\n              <div class="col-1" style="padding: 0">\n                  <button class="comment_edit" type="submit" style="padding: 0; max-height: 100%; height: 100%; max-width: 100%; width: 100%; border: 0;"><span class="fa fa-caret-right" style="float: left; font-size: 1.5em;margin-left: 0.75em;"></span></button>\n              </div>\n          </div>\n        </form>\n      </div>\n    </div>`,t.querySelector("form.comment_edit").addEventListener("submit",sendEditCommentRequest)}function sendEditCommentRequest(e){let t=this.querySelector("textarea").value,o=this.closest("div.comment_edit_container").getAttribute("data-id");return""!=t&&sendAjaxRequest("put","/api/comments/"+o+"/edit",{body:t},commentUpdateHandler),e.preventDefault(),!1}function commentUpdateHandler(){if(200!=this.status&&201!=this.status)return void(window.location="/");let e=JSON.parse(this.responseText);document.querySelector('div.comment_edit_container[data-id="'+e.comment_id+'"]').remove();let t=createComment(e);document.querySelector('article.post[data-id="'+e.post_id+'"]').querySelector("div.post_container form").querySelector("textarea").value="",document.querySelector("div.comments").prepend(t)}function sendDeletePostRequest(e){let t=this.closest("article").getAttribute("data-id");sendAjaxRequest("delete","/api/posts/"+t,null,postDeletedHandler,postDeleteErrorHandler)}function sendArchivePostRequest(e){let t=this.closest("article").getAttribute("data-id");sendAjaxRequest("put","/api/posts/"+t+"/archive",null,postArchiveHandler)}function sendUnarchivePostRequest(e){let t=this.closest("article").getAttribute("data-id");sendAjaxRequest("put","/api/posts/"+t+"/unarchive",null,postUnarchiveHandler)}function openReportPostModal(e){let t=this.closest("article").getAttribute("data-id");$("#reportModal").modal("show");let o=document.querySelector("#reportModal");o.querySelector("#reportModalLabel").innerHTML="Report post",o.querySelector("#report_id").value=t,o.querySelector(".sendReport").removeEventListener("click",sendReportCommentRequest),o.querySelector(".sendReport").removeEventListener("click",sendReportEventRequest),o.querySelector(".sendReport").removeEventListener("click",sendReportGroupRequest),o.querySelector(".sendReport").addEventListener("click",sendReportPostRequest)}function sendReportPostRequest(e){let t=this.closest("#reportModal"),o=t.querySelector("#report_id").value;t.querySelector("#report_id").value="";let n=t.querySelector("#report_title").value;t.querySelector("#report_title").value="";let r=t.querySelector("#report_description").value;t.querySelector("#report_description").value="",$("#reportModal").modal("hide"),sendAjaxRequest("put","/api/posts/"+o+"/report",{title:n,description:r},postReportedHandler,postReportErrorHandler)}function sendCreatePostRequest(e){let t=this.querySelector("input[name=title]").value,o=this.querySelector("textarea").value,n=this.querySelector('input[name="image"]').value,r=this.querySelector('input[name="file"]').value,s="",i=window.location.pathname.split("/");s="feed"==i[1]?"/api/posts/":"groups"==i[1]?"/api/groups/"+i[2]+"/posts/":"events"==i[1]?"/api/events/"+i[2]+"/posts/":"/api/posts/";let d=new FormData(this);return""===n&&d.delete("image"),""===r&&d.delete("file"),""!=t&&""!=o&&sendEnctypeAjaxRequest("post",s,d,postAddedHandler,postAddErrorHandler),e.preventDefault(),!1}function sendCreateCommentRequest(e){let t=this.querySelector("textarea").value,o=this.closest("article").getAttribute("data-id");return""!=t&&sendAjaxRequest("put","/api/posts/"+o+"/comment",{body:t},commentAddedHandler,commentAddErrorHandler),e.preventDefault(),!1}function postDeletedHandler(){if(200!=this.status)return void addErrorFeedback("Failed to delete post.");let e=JSON.parse(this.responseText),t=document.querySelector('article.post[data-id="'+e.post_id+'"]');$("#popup-"+e.post_id).modal("hide"),t.remove(),addFeedback("Post deleted successfully")}function postArchiveHandler(){if(200!=this.status)return void addErrorFeedback("Failed to archive post.");let e=JSON.parse(this.responseText),t=document.querySelector('article.post[data-id="'+e.post_id+'"]');$("#popup-"+e.post_id).modal("hide"),t.remove(),addFeedback("Post archive successfully")}function postUnarchiveHandler(){if(200!=this.status)return void addErrorFeedback("Failed to unarchive post.");let e=JSON.parse(this.responseText),t=document.querySelector('article.post[data-id="'+e.post_id+'"]');$("#popup-"+e.post_id).modal("hide"),t.remove(),addFeedback("Post unarchive successfully")}function postDeleteErrorHandler(){addErrorFeedback("Failed to delete post.")}function postReportedHandler(){if(201!==this.status&&200!==this.status)return void addErrorFeedback("Failed to report post.");JSON.parse(this.responseText);addFeedback("Post reported sucessfully.")}function postReportErrorHandler(){addErrorFeedback("Failed to report post.")}function postAddedHandler(){if(201!==this.status&&200!==this.status)return void addErrorFeedback("Failed to add post.");let new_post=this.responseText,form=document.querySelector("form#post_form");form.querySelector("[type=text]").value="",form.querySelector("textarea").value="",form.querySelector('input[name="image"]').value="",form.querySelector('input[name="file"]').value="",form.querySelector("img#image").style.display="none",form.querySelector("canvas.file").style.display="none",form.querySelector("img.file").style.display="none",form.querySelector("div#postInputImages").style.display="none",form.insertAdjacentHTML("afterend",new_post),new_post=document.querySelectorAll(".post")[0];let postDeleter=new_post.querySelector("button.delete");postDeleter.addEventListener("click",sendDeletePostRequest);let postLikers=new_post.querySelectorAll("article.post button.upvote");[].forEach.call(postLikers,function(e){e.addEventListener("click",sendLikePostRequest)});let postDislikers=new_post.querySelectorAll("article.post button.downvote");[].forEach.call(postDislikers,function(e){e.addEventListener("click",sendDislikePostRequest)}),new_post.querySelector("div.post_container form").addEventListener("submit",sendCreateCommentRequest);let script=new_post.getElementsByTagName("script")[0];eval(script.innerHTML),addFeedback("Post added successfully.")}function postAddErrorHandler(){addErrorFeedback("Failed to add post.")}function commentAddedHandler(){if(200!=this.status&&201!=this.status)return void addErrorFeedback("Failed to add comment.");let e=JSON.parse(this.responseText);createComment(e);document.querySelector('article.post[data-id="'+e.post_id+'"]').querySelector("div.post_container form").querySelector("textarea").value="",addFeedback("Comment added successfully.")}function commentAddErrorHandler(){addErrorFeedback("Failed to add comment."),document.innerHTML=this.responseText}function createPost(e){const t=new Date(e.date);let o,n;o=t.getDate()<10?"0"+t.getDate():t.getDate(),n=t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1;const r=t.getFullYear();let s,i;s=t.getHours()<10?"0"+t.getHours():t.getHours(),i=t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes();let d=document.createElement("article");return d.classList.add("post"),d.setAttribute("data-id",e.post_id),d.innerHTML=`\n  <div class="modal fade" id="popup-${e.post_id}" tabindex="-1" role="dialog" \n        aria-labelledby="postModal-${e.post_id}" aria-hidden="true">\n    <div class="modal-dialog" role="document" style="overflow: initial; max-width: 90%; width: 90%; max-height: 90%; height: 90%">\n        <div class="modal-content" style="height: 100%;">\n            <div class="modal-header post_header" >\n                <div class="container" style="border-bottom:0;border-radius:0;max-width: 90%;">\n                    <div class="row">\n                        <div class="col-sm-2">\n                            <img src="https://www.pluspixel.com.br/wp-content/uploads/avatar-7.png" class="mx-auto d-block" alt="..." style="border-radius:50%; max-width:7rem; " onclick="window.location.href='./users/${e.author_id}'"/>\n                        </div>\n                        <div class="col-sm-10">\n                            <div class="row">\n                                <div class="col-sm-9" style="background-color: transparent;">\n                                    <div class="row" style="background-color: transparent;">\n                                        <h2 class="list-group-item" style="background-color: transparent; border:none;padding-top:0.2rem;padding-bottom:0.2rem">${e.regular_user.user.name}</h2>\n                                    </div>\n                                    <div class="row" style="background-color: transparent;">\n                                        <h3 class="list-group-item" style="background-color: transparent; border:none;padding-top:0.2rem;padding-bottom:0.2rem">${e.regular_user.university}</h3>\n                                    </div>\n                                </div>\n                                <div class="col-sm-3" style="padding-top:0.2rem;padding-bottom:0.2rem; text-align: right; font-size: 1.25em;">\n                                    <p class="card-text" style="margin-bottom:0rem"> ${o}-${n}-${r}</p>\n                                    <p class="card-text">${s}:${i}</p>\n                                </div>\n                            </div>\n                            <div class="row justify-content-end" style="font-size: 1.2em;">\n                                <span class="fa fa-thumbs-up post_like">&nbsp;0&nbsp;</span>\n                                <span class="fa fa-thumbs-down post_dislike">&nbsp;0&nbsp;</span>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n                <div>\n                  <button type="button" data-dismiss="modal" style="font-size: 150%; margin-right: 0; padding-right: 0; width: 100%; background-color: white; border: 0;"><span class="fa fa-times"></span></button>\n                  <div class="btn-group dropleft" style="margin-right: 0; padding-right: 0; width: 100%">\n                      <button type="button" data-toggle="dropdown" style="font-size: 150%; margin-right: 0; padding-right: 0; width: 100%; background-color: white; border: 0;"> \n                      <span class="fa fa-ellipsis-v" ></span></button>\n                      <div class="dropdown-menu options_menu" style="min-width:5rem">\n                          <ul class="list-group">\n                              <li class="list-group-item options_entry" style="text-align: left;">\n                                  <button style=" margin-left:auto; margin-right:auto; background-color: white; border: 0;">Edit</button>\n                              </li>\n                              <li class="list-group-item options_entry" style="text-align: left;">\n                                  <button class='delete' style=" background-color: white; border: 0;" > \n                                      Delete\n                                  </button>\n                              </li>\n                          </ul>\n                      </div>\n                  </div>\n                </div>\n            </div>\n            <div class="modal-body post_container" style="overflow-y: auto;">\n                <div class="container" style="border-bottom:0;border-top:0;border-radius:0;height:100%;">\n                    <div class="row">\n                        <h2>${e.title}</h2>  \n                    </div>\n                    <div class="row post_content">\n                        <p>${e.body}</p>\n                    </div>\n                    <form method="put" action="/api/posts/${e.post_id}/comment">\n                        <div class="row post_comment_form" >\n                            <div class="col-2">\n                                <img src="https://www.pluspixel.com.br/wp-content/uploads/avatar-7.png" class="mx-auto d-block" alt="..." style="border-radius:50%; max-width:2rem; ">\n                            </div>\n                            <div class="col-9 post_comment_form_text">\n                                <textarea class="form-control" required placeholder="Comment..." rows="1"></textarea>\n                            </div>\n                            <div class="col-1" style="padding: 0">\n                                <button type="submit" style="padding: 0; max-height: 100%; height: 100%; max-width: 100%; width: 100%; background-color: white; border: 0;"><span class="fa fa-caret-right" style="float: left; font-size: 1.5em;margin-left: 0.75em;"></span></button>\n                            </div>\n                        </div>\n                    </form>\n                    <div style="">\n                        \n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n  </div>\n  <div class="card mb-3" style="max-width:70%;margin:5% 15%">\n        <button type="button" id="postModal-${e.post_id}" class="btn btn-primary" data-toggle="modal" data-target="#popup-${e.post_id}" style="text-align:left;background: none; color: inherit; border: none; padding: 0; font: inherit; cursor: pointer; outline: inherit;"> \n            <div class="row no-gutters">\n                <div class="col-sm">\n                    <div class="card text-center" style="border-bottom:none;border-top:none;border-radius:0;height:100%;">\n                        <img src="https://www.pluspixel.com.br/wp-content/uploads/avatar-7.png" class="card-img-top mx-auto d-block" alt="..." style="border-radius:50%; max-width:5rem; padding-top:0.8rem">\n                        <ul class="list-group list-group-flush">\n                            <li class="list-group-item" style="border:none;padding-top:0.2rem;padding-bottom:0.2rem">${e.regular_user.user.name}\n                            </li>\n                            <li class="list-group-item" style="border:none;padding-top:0.2rem;padding-bottom:0.2rem">${e.regular_user.university}</li>\n                            <li class="list-group-item" style="border:none;padding-top:0.2rem;padding-bottom:0.2rem">4 friends\n                            </li>\n                        </ul>\n                    </div>\n                </div>\n                <div class="col-md-8" style="flex-grow:1; max-width:100%; text-align: left;">\n                    <div class="card" style="height: 100%; margin-bottom: 0;">\n                        <div class="card-body" style="margin-bottom: 0;padding-bottom: 0;">\n                            <h3 class="card-title">${e.title}</h3>\n                            <p class="card-text">\n                            ${e.body}\n                            </p>\n                            <p class="card-text" style="margin-bottom:0rem; float: right;"><small class="text-muted" style="margin-bottom:0rem">${o}-${n}-${r}</small>, <small class="text-muted" style="margin-bottom:0.2rem">${s}:${i}</small></p>\n                        </div>\n                        <div class="card-footer" style="border-left:none;border-right:none;border-bottom:none">\n                            <span class="comment"> 0 comments </span>\n                            <div style="float: right;">\n                                <span class="fa fa-thumbs-up post_like">&nbsp;0&nbsp;</span>\n                                <span class="fa fa-thumbs-down post_dislike">&nbsp;0&nbsp;</span>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </button>\n    </div>`,d}function createComment(e){let t=document.createElement("div");return t.classList.add("row","comment_container","comment_no_padding"),t.setAttribute("data-id",e.comment_id),t.innerHTML=`\n    <div class="col-2 comment_user_info" >\n        <div class="row">   \n            <img src="https://www.pluspixel.com.br/wp-content/uploads/avatar-7.png" class="mx-auto d-block" alt="..." style="border-radius:50%; max-width:2rem; "  onclick="window.location.href='./users/${e.user.user_id}'">\n        </div>\n        <div class="row">\n            <h4 style="font-size: 1em; margin: 0 auto;">${e.user.user.name}</h4>\n        </div>\n    </div>\n    <div class="col-9 comment_text">\n        <p>${e.body}</p>\n    </div>\n    <div>\n        <div class="btn-group dropright" style="margin-right: 0; padding-right: 0; width: 100%">\n            <button type="button" data-toggle="dropdown" style="font-size: 150%; margin-right: 0; padding-right: 0; width: 100%; background-color: white; border: 0;"> \n            <span class="fa fa-ellipsis-v" ></span></button>\n            <div class="dropdown-menu options_menu" style="min-width:5rem">\n                <ul class="list-group">\n                    <li class="list-group-item options_entry" style="text-align: left;">\n                        <button class='comment_edit' style=" margin-left:auto; margin-right:auto; background-color: white; border: 0;">\n                            Edit\n                        </button>\n                    </li>\n                    <li class="list-group-item options_entry" style="text-align: left;">\n                        <button class='comment_delete' style=" background-color: white; border: 0;" > \n                            Delete\n                        </button>\n                    </li>\n                </ul>\n            </div>\n        </div>\n    </div>`,t.querySelector(".comment_container div.options_menu .comment_delete").addEventListener("click",sendDeleteCommentRequest),t.querySelector(".comment_container div.options_menu .comment_edit").addEventListener("click",setCommentEditBox),t}function createMessage(e){let t=document.createElement("p");return t.className="chat_my_message",t.innerHTML=`\n    ${e.body}\n  `,t}addEventListeners();